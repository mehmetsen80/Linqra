spring:
  application:
    name: api-gateway
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true
    web-application-type: reactive
  session:
    store-type: none
  data:
    redis:
      host: localhost
      port: 6379
      database: 0
      timeout: 60000
      connect-timeout: 60000
    mongodb:
      uri: ${MONGO_GATEWAY_URL:mongodb://${vault.mongodb.username:root}:${vault.mongodb.password:mongopw}@localhost:27017,localhost:27018,localhost:27019/?replicaSet=rs0&authSource=admin&readConcernLevel=majority}
      database: Linqra
      auto-index-creation: true  # Explicitly enable auto-index creation (default is true)
  security:
    oauth2:
      client:
        registration:
          linqra-gateway-client:
            client-id: test-client
            client-secret: test-secret
            authorization-grant-type: authorization_code
            scope: gateway.read
            redirect-uri: http://localhost:3000/callback
            provider: keycloak
        provider:
          keycloak:
            token-uri: http://localhost:8281/test/token
            authorization-uri: http://localhost:8281/test/auth
            jwk-set-uri: http://localhost:8281/test/certs
            issuer-uri: http://localhost:8281/test
      resourceserver:
        opaquetoken:
          introspection-uri: http://localhost:8281/test/token/introspect
          client-id: test-client
          client-secret: test-secret
        jwt:
          issuer-uri: http://localhost:8281/test
          jwk-set-uri: http://localhost:8281/test/certs

  cloud:
    circuitbreaker:
      resilience4j:
        enabled: true
    loadbalancer:
      enabled: true
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true

management:
  endpoints:
    web:
      exposure:
        include: health,info,loggers,threaddump, metrics

eureka:
  client:
    enabled: true
    service-url:
      defaultZone: http://localhost:8761/eureka/eureka/
    register-with-eureka: false
    fetch-registry: false
    eureka-server-connect-timeout-seconds: 60
    eureka-server-read-timeout-seconds: 60

server:
  host: localhost
  port: 7777
  http2:
    enabled: false
  ssl:
    enabled: false

logging:
  level:
    root: INFO
    org.lite.gateway: INFO

notifications:
  email:
    host: test-host
    port: 587
    username: ${vault.smtp.username:test-username}
    password: ${vault.smtp.password:test-password}
    to: test@example.com
    from: noreply@linqra.com
    enabled: false
  slack:
    webhook-url: ${vault.slack.webhook.url:https://test-webhook-url}
    enabled: ${vault.slack.enabled:false}

cors:
  allowed-origins: http://localhost:3000,https://localhost:3000,https://localhost:8080,https://your-prod-domain.com
  allowed-methods: GET,POST,PUT,PATCH,DELETE,OPTIONS,HEAD
  allowed-headers: Origin,Content-Type,Accept,Authorization,X-Requested-With,X-User-Token
  max-age: 3600

jwt:
  secret: 3a98d4c7b6e5f2a1d8c9b4a7e6f3d2c1b8a7e6f3d2c1b8a7e6f3d2c1b8a7e6f3d2c1b8a7e6f3d2c1b8a7e6f3d2c1b8a7e6f3d2c1
  expiration: 86400000 # 24 hours in milliseconds

milvus:
  host: localhost
  port: 19530
  username: milvus_admin
  password: Linqra2024!

# Knowledge Hub S3 Configuration
aws:
  region: ${vault.aws.region:us-west-2}
  s3:
    bucket: ${vault.aws.s3.bucket.name:linqra-knowledge-hub-test}

# Vault Configuration (Mock for tests)
vault:
  master:
    key: "mock-master-key-for-testing-only"
  mongodb:
    username: root
    password: mongopw
  # Storage defaults for test
  storage:
    type: s3
    endpoint: ""
  minio:
    access:
      key: minioadmin
    secret:
      key: minioadmin

linqra:
  storage:
    type: ${vault.storage.type:s3}
    endpoint: ${vault.storage.endpoint:}
    access-key: ${vault.minio.access.key:}
    secret-key: ${vault.minio.secret.key:}
    bucket-name: linqra-knowledge-hub-test
    backup-bucket-name: backup-linqra-knowledge-hub-test
    backup-bucket-region: us-east-1
    raw-prefix: raw
    processed-prefix: processed
    presigned-url-expiration: PT15M
    max-file-size: 52428800
    redis:
      document-processing-channel: document-processing-queue

neo4j:
  uri: ${vault.neo4j.uri:bolt://localhost:7687}
  username: ${vault.neo4j.username:neo4j}
  password: ${vault.neo4j.password:neo4j}
